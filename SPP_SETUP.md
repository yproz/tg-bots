# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –°–ü–ü –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –°–ü–ü –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
   - –î–æ–±–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å `parser_service_v2.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä—Å–µ—Ä–æ–º API
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏ –ë–î –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –°–ü–ü
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `parser_tasks` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–¥–∞—á –ø–∞—Ä—Å–µ—Ä–∞

2. **–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–æ–≤**
   - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –°–ü–ü
   - CSV –æ—Ç—á–µ—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç: –ê—Ä—Ç–∏–∫—É–ª | –ù–∞–∑–≤–∞–Ω–∏–µ | –¶–µ–Ω–∞ –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–µ | –¶–µ–Ω–∞ –∏–∑ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ | % —Å–∫–∏–¥–∫–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª—ã–º –ø–µ—Ä–∏–æ–¥–æ–º

3. **–£–ª—É—á—à–µ–Ω Telegram –±–æ—Ç**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/collect_now` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–±–æ—Ä–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω –º–∞—Å—Ç–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª–µ–º `parser_api_key`
   - –£–ª—É—á—à–µ–Ω —à–∞–±–ª–æ–Ω Excel —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

4. **–û–±–Ω–æ–≤–ª–µ–Ω—ã Celery –∑–∞–¥–∞—á–∏**
   - –ù–æ–≤–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ: 14:00 (—Å–±–æ—Ä) ‚Üí 14:30 (–ø—Ä–æ–≤–µ—Ä–∫–∞) ‚Üí 15:00 (–æ—Ç—á–µ—Ç—ã)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä—Å–µ—Ä–æ–º API
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–±–æ—Ä–∞

## üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ú–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:
```sql
-- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è
ALTER TABLE accounts ADD COLUMN topic_id BIGINT;
ALTER TABLE raw_prices ADD COLUMN discount_percent NUMERIC;

-- –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –∑–∞–¥–∞—á –ø–∞—Ä—Å–µ—Ä–∞
CREATE TABLE parser_tasks (
    id BIGSERIAL PRIMARY KEY,
    client_id TEXT REFERENCES clients(id),
    account_id INTEGER REFERENCES accounts(id),
    task_id TEXT UNIQUE NOT NULL,
    market TEXT NOT NULL,
    status TEXT NOT NULL,
    report_url TEXT,
    created_at DATE NOT NULL,
    completed_at DATE
);

-- –°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_parser_tasks_client_id ON parser_tasks(client_id);
CREATE INDEX idx_parser_tasks_status ON parser_tasks(status);
CREATE INDEX idx_raw_prices_discount ON raw_prices(discount_percent);
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤

–ß–µ—Ä–µ–∑ Telegram –±–æ—Ç:

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞:**
   ```
   /add_client
   ‚Üí –í–≤–µ–¥–∏—Ç–µ client_id (–Ω–∞–ø—Ä–∏–º–µ—Ä: SEB)
   ‚Üí –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: SEB)
   ‚Üí –í–≤–µ–¥–∏—Ç–µ chat_id –≥—Ä—É–ø–ø—ã (–∏–ª–∏ 0)
   ‚Üí –í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –ø–∞—Ä—Å–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: WKLculgyZrUuldii7Oq0yNmIKdE=)
   ```

2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞:**
   ```
   /add_account
   ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ marketplace (ozon/wb)
   ‚Üí –í–≤–µ–¥–∏—Ç–µ client_id (SEB)
   ‚Üí –í–≤–µ–¥–∏—Ç–µ account_id (–Ω–∞–ø—Ä–∏–º–µ—Ä: fm)
   ‚Üí –í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á–∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
   ‚Üí –í–≤–µ–¥–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω (–ú–æ—Å–∫–≤–∞)
   ```

3. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤:**
   ```
   /get_template
   ‚Üí –°–∫–∞—á–∞–π—Ç–µ Excel —Ñ–∞–π–ª
   ‚Üí –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤
   ‚Üí –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –æ–±—Ä–∞—Ç–Ω–æ –±–æ—Ç—É
   ```

### 3. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
docker-compose down
docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f bot
docker-compose logs -f worker
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
python test_spp_functionality.py

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞
# –í –±–æ—Ç–µ: /collect_now
```

## üìä –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–æ–≤

### –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞ (15:00 MSK):
```
üìä –°–ü–ü –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: SEB
üìÖ 15.01.2025

üîª 5 —Ç–æ–≤–∞—Ä–æ–≤ —Å–Ω–∏–∑–∏–ª–∏ –°–ü–ü
üî∫ 3 —Ç–æ–≤–∞—Ä–∞ –ø–æ–≤—ã—Å–∏–ª–∏ –°–ü–ü
‚ûñ 12 —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
üÜï 2 –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–∞

üìà –í—Å–µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è: 22 —Ç–æ–≤–∞—Ä–∞

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
```

### CSV –æ—Ç—á–µ—Ç:
| –ê—Ä—Ç–∏–∫—É–ª | –ù–∞–∑–≤–∞–Ω–∏–µ | –¶–µ–Ω–∞ –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–µ | –¶–µ–Ω–∞ –∏–∑ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ | % —Å–∫–∏–¥–∫–∏ |
|---------|----------|-----------------|---------------------|----------|
| 1101001001 | –§—É—Ç–±–æ–ª–∫–∞ –º—É–∂—Å–∫–∞—è | 899 | 1299 | 30.8 |
| 1101001020 | –î–∂–∏–Ω—Å—ã –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ | 1499 | 1999 | 25.0 |

## ‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

- **14:00 MSK** - –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥
- **14:30 MSK** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –æ—Ç—á–µ—Ç–æ–≤
- **15:00 MSK** - –û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Å–≤–æ–¥–æ–∫

## üîç –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- `/add_client` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- `/add_account` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
- `/get_template` - –ø–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ Excel
- `/collect_now` - —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞
- `/snapshot YYYY-MM-DD` - –æ—Ç—á–µ—Ç –∑–∞ –¥–∞—Ç—É

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs -f bot

# –õ–æ–≥–∏ Celery worker
docker-compose logs -f worker

# –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose logs -f db
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –°—Ç–∞—Ç—É—Å Celery
docker-compose exec worker celery -A tasks.app inspect active
```

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **API –∫–ª—é—á–∏ –ø–∞—Ä—Å–µ—Ä–∞** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
2. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤** - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –¥–Ω–µ–º
3. **Excel —Ñ–æ—Ä–º–∞—Ç** - —Å—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–ª–æ–Ω–æ–∫
4. **–¢—Ä–µ–¥—ã Telegram** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/set_topic` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è –°–ü–ü –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ø–æ–¥ –°–ü–ü
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –ü–∞—Ä—Å–µ—Ä API –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –û—Ç—á–µ—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ Telegram –±–æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ Celery –∑–∞–¥–∞—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

–ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å —Å–∏—Å—Ç–µ–º–æ–π! 