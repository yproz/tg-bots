# Чек‑лист аудита и рефакторинга Telegram‑бота **pricebot**

> **Общее правило:** На виртуалке работают другие проекты — любые действия **не должны** прерывать их работу.
>
> **SSH‑справка (только как ориентир):** `ssh -i /Users/yuprozorov/ssh-key price-robot-vm@89.169.152.79`  
> Проверку контейнеров выполнять в каталоге `pricebot`, не затрагивая остальные.
> git https://github.com/yproz/tg-bots
>
> Отмечайте `x` в `[ ]`, чтобы фиксировать прогресс.

---

## 1. Базовый аудит кода и зависимостей

- [ ] **Собрать метрики качества**: сложность, дублирование, «мёртвый» код.
  - [ ] Зафиксировать результаты для отчёта (технический долг).
- [ ] **Проверить зависимости**: версии, устаревшие пакеты, уязвимости.
- [ ] **Оценить структуру проекта** на соответствие best‑practice (SRP, логическая связность).
- [ ] **Собрать feedback** от команды о болевых точках кода.

## 2. Формулирование целей рефакторинга

- [ ] Сформулировать список проблем, требующих исправления.
- [ ] Определить приоритеты (критично / желательно / «можно позже»).
- [ ] Разбить работу на инкрементальные задачи (до 2–4 ч каждая).
- [ ] Утвердить план с заинтересованными сторонами.

## 3. Подготовка веток и окружений

- [ ] Создать ветку `refactor` от актуального `main`.
- [ ] Настроить GitLab Labels / Milestone «refactor‑phase‑1» для задач.
- [ ] Подготовить отдельный **staging** контейнер на VM, изолированный от прод‑контейнеров.
  - [ ] Назвать сервис `pricebot-staging`, чтобы исключить конфликт имён.

## 4. Инкрементальный рефакторинг

- [ ] Внедрить автоматическую проверку стиля (lint) в CI.
- [ ] Переписать наиболее «тяжёлые» модули по приоритету.
- [ ] Удалить/заменить дублирующийся и «мёртвый» код.
- [ ] Покрыть ключевые пути unit‑тестами (целевой coverage ≥ 90 %).
- [ ] Обновить зависимые сервисы/образ Docker, если требуется.

## 5. Верификация на staging‑окружении

- [ ] Автоматически разворачивать `refactor` в `pricebot‑staging` на VM.
- [ ] Проверить, что остальные проекты на сервере не затронуты.
- [ ] Провести smoke‑тесты функциональности бота.
- [ ] Собрать логи и метрики, убедиться в отсутствии ошибок.

## 6. Пользовательское тестирование

- [ ] Передать ссылку/токен staging‑бота заказчику для проверки.
- [ ] Зафиксировать баг‑репорты и пожелания.
- [ ] Оценить, требуют ли найденные проблемы доработок в рамках рефакторинга.

## 7. Синхронизация с прод‑окружением

- [ ] Смержить `refactor` → `main` через Merge Request и ревью.
- [ ] Запустить production pipeline, разворачивающий обновлённый образ.
- [ ] Проверить, что прод‑контейнер запустился корректно, другие проекты работают.

## 8. Настройка двусторонней синхронизации с VM

- [ ] Настроить GitLab CI deploy job для автообновления контейнера после merge.
- [ ] Настроить cron‑job на VM для pull — если offline‑изменения (hotfix) сделаны прямо на сервере, они пушатся в GitLab.
  - [ ] Ограничить cron‑скрипт каталогом `pricebot`, исключив другие проекты.

## 9. Итоговая отчётность и документация

- [ ] Обновить `CHANGELOG.md` с описанием изменений.
- [ ] Обновить `README.md` и `docs/ARCHITECTURE.md` (новые модули, схема).
- [ ] Подготовить короткий отчёт заказчику: «Что сделано, что улучшено, планы».

---

> Используй список как навигатор: проходи по разделам, отмечай выполненное. По итогу рефакторинг пройдёт прозрачно, не затронет другие сервисы и даст чистую, поддерживаемую кодовую базу.

