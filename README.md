# –°–ü–ü –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ë–æ—Ç

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –°–ü–ü (–°–æ–≤–º–µ—Å—Ç–Ω—ã—Ö –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π) –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞—Ö Ozon –∏ Wildberries —á–µ—Ä–µ–∑ Telegram –±–æ—Ç.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **–°–±–æ—Ä —Ü–µ–Ω —á–µ—Ä–µ–∑ –ø–∞—Ä—Å–µ—Ä API** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä —Ü–µ–Ω —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª—ã–º –ø–µ—Ä–∏–æ–¥–æ–º** ‚Äî –∞–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –°–ü–ü
- **–û—Ç—á–µ—Ç—ã –≤ Telegram** ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
- **–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ Excel** ‚Äî —É–¥–æ–±–Ω—ã–π –∏–º–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤
- **–ú—É–ª—å—Ç–∏–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## üìä –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–æ–≤

### –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞
```
üìä –°–ü–ü –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: SEB
üìÖ 15.01.2025

üîª 5 —Ç–æ–≤–∞—Ä–æ–≤ —Å–Ω–∏–∑–∏–ª–∏ –°–ü–ü
üî∫ 3 —Ç–æ–≤–∞—Ä–∞ –ø–æ–≤—ã—Å–∏–ª–∏ –°–ü–ü
‚ûñ 12 —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

üìà –í—Å–µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è: 22 —Ç–æ–≤–∞—Ä–∞

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
```

### –ü–æ–¥—Ä–æ–±–Ω—ã–π Excel –æ—Ç—á–µ—Ç
| –ê—Ä—Ç–∏–∫—É–ª | –ù–∞–∑–≤–∞–Ω–∏–µ | –¶–µ–Ω–∞ –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–µ | –¶–µ–Ω–∞ –∏–∑ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ | % —Å–∫–∏–¥–∫–∏ |
|---------|----------|-----------------|---------------------|----------|
| 1101001001 | –§—É—Ç–±–æ–ª–∫–∞ –º—É–∂—Å–∫–∞—è | 899 | 1299 | 30.8 |
| 1101001020 | –î–∂–∏–Ω—Å—ã –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ | 1499 | 1999 | 25.0 |

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram Bot  ‚îÇ    ‚îÇ Celery Beat   ‚îÇ    ‚îÇ Celery Worker ‚îÇ
‚îÇ  (aiogram 3)  ‚îÇ    ‚îÇ (Scheduler)   ‚îÇ    ‚îÇ (Tasks, v2)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                    ‚îÇ                    ‚îÇ
        ‚ñº                    ‚ñº                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PostgreSQL    ‚îÇ    ‚îÇ   Redis    ‚îÇ    ‚îÇ  Parser API     ‚îÇ
‚îÇ (SQLAlchemy v2) ‚îÇ    ‚îÇ (Broker)   ‚îÇ    ‚îÇ  (Market Data)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

- –í—Å–µ –∑–∞–¥–∞—á–∏ –∏ –ª–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ `tasks/app_v2.py` –∏ `services/parser_service_v2.py`.
- –û—Ç—á–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç –ø–∞—Ä—Å–µ—Ä–∞** (–∑–∞–ø–∏—Å–∏ showcase_price –≤ –ë–î).
- –†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –æ—Ç—á–µ—Ç–æ–≤ ‚Äî –∫–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã (Celery Beat).

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone git@github.com:yproz/tg-bots.git
cd tg-bots

# –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp env.example .env

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
nano .env
```

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Production VM

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH alias (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑)
echo "Host pricebot-vm
    HostName 89.169.152.79
    User price-robot-vm
    IdentityFile /Users/yuprozorov/ssh-key
    IdentitiesOnly yes" >> ~/.ssh/config

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh pricebot-vm

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd pricebot && docker-compose ps
```

### 3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# Telegram Bot
BOT_TOKEN=your_telegram_bot_token
BOT_USERNAME=your_bot_username

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql+asyncpg://pricebot:password@db:5432/pricebot

# Redis
CELERY_BROKER=redis://redis:6379/0
CELERY_BACKEND=redis://redis:6379/0

# –ü–∞—Ä—Å–µ—Ä API (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞)
PARSER_API_KEY=your_parser_api_key
```

### 4. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
# –°–æ–∑–¥–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏
docker-compose logs -f bot
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

–ß–µ—Ä–µ–∑ Telegram –±–æ—Ç:

1. `/add_client` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
2. `/add_account` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
3. `/get_template` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ Excel
4. –ó–∞–≥—Ä—É–∑–∏—Ç—å Excel —Å —Ç–æ–≤–∞—Ä–∞–º–∏

## üìã –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- `/add_client` ‚Äî –º–∞—Å—Ç–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
- `/add_account` ‚Äî –º–∞—Å—Ç–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
- `/get_template` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ Excel –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
- `/collect_now` ‚Äî –∑–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ —Ü–µ–Ω –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ Excel —Ñ–∞–π–ª —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
- –§–æ—Ä–º–∞—Ç: `client_id | market | account_id | product_code | product_name | product_link`

### –û—Ç—á–µ—Ç—ã
- `/snapshot YYYY-MM-DD` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –∑–∞ –¥–∞—Ç—É
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ **–ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

## ‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á

- **–ö–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã** ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –æ—Ç—á–µ—Ç–æ–≤ –æ—Ç –ø–∞—Ä—Å–µ—Ä–∞ (Celery Beat)
- **–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤** ‚Äî –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ showcase_price –≤ –ë–î (–ø–æ —Ñ–∞–∫—Ç—É –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

## üóÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `clients` ‚Äî –∫–ª–∏–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
- `accounts` ‚Äî –∞–∫–∫–∞—É–Ω—Ç—ã –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
- `products` ‚Äî —Ç–æ–≤–∞—Ä—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `orders` ‚Äî –∑–∞–∫–∞–∑—ã –Ω–∞ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (task_id, —Å—Ç–∞—Ç—É—Å, —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç—á–µ—Ç)
- `results` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ç–æ–≤–∞—Ä–∞–º (—Ü–µ–Ω—ã, —Å–∫–∏–¥–∫–∏, showcase_price)

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è
- `parser_api_key` ‚Äî –∫–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä—Å–µ—Ä–æ–º
- `discount_percent` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏ –°–ü–ü
- `group_chat_id` ‚Äî ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
pricebot/
‚îú‚îÄ‚îÄ .gitlab/            # GitLab –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ CODEOWNERS      # –ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–≤—å—é–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ bot/                # Telegram –±–æ—Ç
‚îÇ   ‚îî‚îÄ‚îÄ main.py         # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îú‚îÄ‚îÄ db/                 # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ models.py       # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ session.py      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Å—Å–∏–π
‚îú‚îÄ‚îÄ docs/               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ ARCHITECTURE.md      # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ BRANCH_PROTECTION.md # –ó–∞—â–∏—Ç–∞ –≤–µ—Ç–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ CICD_SETUP.md       # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD
‚îÇ   ‚îú‚îÄ‚îÄ GITLAB_SECRETS_SETUP.md # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ SETUP_PROTECTION.md  # –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞—â–∏—Ç—ã
‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ collectors/     # –ö–æ–ª–ª–µ–∫—Ç–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ozon.py     # Ozon API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wb.py       # Wildberries API
‚îÇ   ‚îú‚îÄ‚îÄ parser_service_v2.py # –†–∞–±–æ—Ç–∞ —Å –ø–∞—Ä—Å–µ—Ä–æ–º
‚îÇ   ‚îî‚îÄ‚îÄ excel_loader.py      # –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤
‚îú‚îÄ‚îÄ tasks/              # Celery –∑–∞–¥–∞—á–∏
‚îÇ   ‚îî‚îÄ‚îÄ app_v2.py       # –í—Å–µ –∑–∞–¥–∞—á–∏ (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
‚îú‚îÄ‚îÄ .flake8             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è flake8
‚îú‚îÄ‚îÄ .gitlab-ci.yml      # CI/CD pipeline
‚îú‚îÄ‚îÄ .pre-commit-config.yaml # Pre-commit hooks
‚îú‚îÄ‚îÄ docker-compose.yml  # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (prod)
‚îú‚îÄ‚îÄ docker-compose.local.yml # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (dev)
‚îú‚îÄ‚îÄ pyproject.toml      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ requirements.txt    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (prod)
‚îú‚îÄ‚îÄ requirements-dev.txt # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (dev)
‚îî‚îÄ‚îÄ TASKS.md           # –ß–µ–∫-–ª–∏—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose up db redis -d

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
python -m bot.main

# –ó–∞–ø—É—Å–∫ Celery worker
celery -A tasks.app_v2 worker --loglevel=info

# –ó–∞–ø—É—Å–∫ Celery beat
celery -A tasks.app_v2 beat --loglevel=info
```

## üöÄ CI/CD Pipeline

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–±–æ—Ä–∫–∏ –∏ –¥–µ–ø–ª–æ—è.

### –°—Ç–∞–¥–∏–∏ Pipeline

1. **lint** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ (flake8, black, isort, mypy)
2. **test** - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å PostgreSQL + Redis
3. **build** - –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ –≤ GitHub Container Registry
4. **deploy** - –î–µ–ø–ª–æ–π –Ω–∞ production —Å–µ—Ä–≤–µ—Ä (environment protection)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD

```bash
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–∏–Ω—Ç–µ—Ä–æ–≤
pip install -r requirements-dev.txt

# –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
black .
isort .
flake8 .
mypy bot/ services/ db/ tasks/

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest test_basic.py test_excel_upload.py -v
```

### Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. **Feature branch**: –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –æ—Ç `dev`
2. **–ò–∑–º–µ–Ω–µ–Ω–∏—è**: –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∫–æ–º–º–∏—Ç—ã  
3. **Pull Request**: –°–æ–∑–¥–∞–π—Ç–µ PR –≤ GitHub
4. **CI/CD**: –î–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è GitHub Actions
5. **Code Review**: –ó–∞–ø—Ä–æ—Å–∏—Ç–µ —Ä–µ–≤—å—é (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
6. **Merge**: –ü–æ—Å–ª–µ approval ‚Üí merge –≤ `dev`

### –†–µ–ª–∏–∑ –≤ production

1. **Release PR**: –°–æ–∑–¥–∞–π—Ç–µ PR `main ‚Üê dev`
2. **Testing**: –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. **Approval**: –ü–æ–ª—É—á–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–≤—å—é
4. **Deploy**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —Å environment protection

> **–í–∞–∂–Ω–æ**: –í–µ—Ç–∫–∞ `main` –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç –ø—Ä—è–º—ã—Ö push. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ PR —Å —Ä–µ–≤—å—é.

## üì¶ –î–µ–ø–ª–æ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ merge –≤ `main`:
1. GitHub Actions —Å–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —Å environment protection
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh pricebot-vm

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
cd pricebot
git pull origin main

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose pull
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
```

### –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É
git reset --hard HEAD~1
docker-compose up -d

# –ò–ª–∏ –æ—Ç–∫–∞—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ–º–º–∏—Ç—É
git reset --hard <commit-hash>
docker-compose up -d
```

## üìù –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec db psql -U pricebot -d pricebot -f /app/migration_add_orders_results.sql
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏
```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs -f bot

# –õ–æ–≥–∏ Celery
docker-compose logs -f worker

# –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose logs -f db
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
python test_basic.py
```

## üßπ –û—á–∏—Å—Ç–∫–∞ —Å–ª—É–∂–µ–±–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

–î–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–∞–ø–∫–∏ `__pycache__`:
```bash
find . -name "__pycache__" -type d -exec rm -r {} +
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ API –∫–ª—é—á–µ–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–∞ API

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose down

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [üìã –ß–µ–∫-–ª–∏—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏](TASKS.md) - –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
- [üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](docs/ARCHITECTURE.md) - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD](docs/CICD_SETUP.md) - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitLab Pipeline
- [üîí –ó–∞—â–∏—Ç–∞ –≤–µ—Ç–æ–∫](docs/BRANCH_PROTECTION.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞—â–∏—Ç—ã main –≤–µ—Ç–∫–∏
- [üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏](docs/GITLAB_SECRETS_SETUP.md) - –†–∞–±–æ—Ç–∞ —Å API –∫–ª—é—á–∞–º–∏
- [‚ö° –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](docs/SETUP_PROTECTION.md) - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [GitHub Repository](https://github.com/yproz/tg-bots)
- [Production Server](ssh://pricebot-vm) - `ssh pricebot-vm`
- [GitHub Actions](https://github.com/yproz/tg-bots/actions)
- [Container Registry](https://github.com/yproz/tg-bots/pkgs/container/tg-bots)

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. 