# ะกะะ ะะพะฝะธัะพัะธะฝะณ ะะพั

ะกะธััะตะผะฐ ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ะธะทะผะตะฝะตะฝะธะน ะกะะ (ะกะพะฒะผะตััะฝัั ะธะฝะฒะตััะธัะธะน) ะฝะฐ ะผะฐัะบะตัะฟะปะตะนัะฐั Ozon ะธ Wildberries ัะตัะตะท Telegram ะฑะพั.

## ๐ฏ ะัะฝะพะฒะฝัะต ััะฝะบัะธะธ

- **ะกะฑะพั ัะตะฝ ัะตัะตะท ะฟะฐััะตั API** โ ะฐะฒัะพะผะฐัะธัะตัะบะธะน ัะฑะพั ัะตะฝ ั ะผะฐัะบะตัะฟะปะตะนัะพะฒ
- **ะกัะฐะฒะฝะตะฝะธะต ั ะฟัะพัะปัะผ ะฟะตัะธะพะดะพะผ** โ ะฐะฝะฐะปะธะท ะธะทะผะตะฝะตะฝะธะน ะกะะ
- **ะััะตัั ะฒ Telegram** โ ะตะถะตะดะฝะตะฒะฝัะต ัะฒะพะดะบะธ ั ะบะฝะพะฟะบะฐะผะธ ะดะปั ะฟะพะดัะพะฑะฝัั ะพััะตัะพะฒ
- **ะะฐะณััะทะบะฐ ัะพะฒะฐัะพะฒ ัะตัะตะท Excel** โ ัะดะพะฑะฝัะน ะธะผะฟะพัั ัะฟะธัะบะพะฒ ัะพะฒะฐัะพะฒ
- **ะัะปััะธะบะปะธะตะฝััะบะฐั ะฟะพะดะดะตัะถะบะฐ** โ ัะฐะฑะพัะฐ ั ะฝะตัะบะพะปัะบะธะผะธ ะบะปะธะตะฝัะฐะผะธ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ

## ๐ ะคะพัะผะฐั ะพััะตัะพะฒ

### ะะถะตะดะฝะตะฒะฝะฐั ัะฒะพะดะบะฐ
```
๐ ะกะะ ะะพะฝะธัะพัะธะฝะณ: SEB
๐ 15.01.2025

๐ป 5 ัะพะฒะฐัะพะฒ ัะฝะธะทะธะปะธ ะกะะ
๐บ 3 ัะพะฒะฐัะฐ ะฟะพะฒััะธะปะธ ะกะะ
โ 12 ัะพะฒะฐัะพะฒ ะฑะตะท ะธะทะผะตะฝะตะฝะธะน

๐ ะัะตะณะพ ะพััะปะตะถะธะฒะฐะตััั: 22 ัะพะฒะฐัะฐ

ะะฐะถะผะธัะต ะบะฝะพะฟะบั ะฝะธะถะต ะดะปั ะฟะพะดัะพะฑะฝะพะณะพ ะพััะตัะฐ
```

### ะะพะดัะพะฑะฝัะน Excel ะพััะตั
| ะััะธะบัะป | ะะฐะทะฒะฐะฝะธะต | ะฆะตะฝะฐ ะฝะฐ ะฒะธััะธะฝะต | ะฆะตะฝะฐ ะธะท ะผะฐัะบะตัะฟะปะตะนัะฐ | % ัะบะธะดะบะธ |
|---------|----------|-----------------|---------------------|----------|
| 1101001001 | ะคััะฑะพะปะบะฐ ะผัะถัะบะฐั | 899 | 1299 | 30.8 |
| 1101001020 | ะะถะธะฝัั ะบะปะฐััะธัะตัะบะธะต | 1499 | 1999 | 25.0 |

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ
โ Telegram Bot  โ    โ Celery Beat   โ    โ Celery Worker โ
โ  (aiogram 3)  โ    โ (Scheduler)   โ    โ (Tasks, v2)   โ
โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ
        โ                    โ                    โ
        โผ                    โผ                    โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   PostgreSQL    โ    โ   Redis    โ    โ  Parser API     โ
โ (SQLAlchemy v2) โ    โ (Broker)   โ    โ  (Market Data)  โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

- ะัะต ะทะฐะดะฐัะธ ะธ ะปะพะณะธะบะฐ ัะตะฐะปะธะทะพะฒะฐะฝั ะฒ `tasks/app_v2.py` ะธ `services/parser_service_v2.py`.
- ะััะตัั ะพัะฟัะฐะฒะปััััั **ัะพะปัะบะพ ะฟะพัะปะต ะฟะพัะฒะปะตะฝะธั ะฝะพะฒัั ะดะฐะฝะฝัั ะพั ะฟะฐััะตัะฐ** (ะทะฐะฟะธัะธ showcase_price ะฒ ะะ).
- ะะตะณัะปััะฝะฐั ะฟัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ ะพััะตัะพะฒ โ ะบะฐะถะดัะต 3 ะผะธะฝััั (Celery Beat).

## ๐ ะัััััะน ััะฐัั

### 1. ะะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั

```bash
# ะะปะพะฝะธััะตะผ ัะตะฟะพะทะธัะพัะธะน
git clone <repository>
cd pricebot

# ะะพะฟะธััะตะผ ะฟัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ
cp env.example .env

# ะะตะดะฐะบัะธััะตะผ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
nano .env
```

### 2. ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (.env)

```env
# Telegram Bot
BOT_TOKEN=your_telegram_bot_token
BOT_USERNAME=your_bot_username

# ะะฐะทะฐ ะดะฐะฝะฝัั
DATABASE_URL=postgresql+asyncpg://pricebot:password@db:5432/pricebot

# Redis
CELERY_BROKER=redis://redis:6379/0
CELERY_BACKEND=redis://redis:6379/0

# ะะฐััะตั API (ะฝะฐัััะฐะธะฒะฐะตััั ะดะปั ะบะฐะถะดะพะณะพ ะบะปะธะตะฝัะฐ)
PARSER_API_KEY=your_parser_api_key
```

### 3. ะะฐะฟััะบ ัะตัะตะท Docker

```bash
# ะกะพะทะดะฐะตะผ ะธ ะทะฐะฟััะบะฐะตะผ ะบะพะฝัะตะนะฝะตัั
docker-compose up -d

# ะัะพะฒะตััะตะผ ััะฐััั
docker-compose ps

# ะกะผะพััะธะผ ะปะพะณะธ
docker-compose logs -f bot
```

### 4. ะะฐัััะพะนะบะฐ ะบะปะธะตะฝัะพะฒ ะธ ะฐะบะบะฐัะฝัะพะฒ

ะงะตัะตะท Telegram ะฑะพั:

1. `/add_client` โ ะดะพะฑะฐะฒะปะตะฝะธะต ะบะปะธะตะฝัะฐ
2. `/add_account` โ ะดะพะฑะฐะฒะปะตะฝะธะต ะฐะบะบะฐัะฝัะฐ ะผะฐัะบะตัะฟะปะตะนัะฐ
3. `/get_template` โ ะฟะพะปััะตะฝะธะต ัะฐะฑะปะพะฝะฐ Excel
4. ะะฐะณััะทะธัั Excel ั ัะพะฒะฐัะฐะผะธ

## ๐ ะะพะผะฐะฝะดั ะฑะพัะฐ

### ะัะฝะพะฒะฝัะต ะบะพะผะฐะฝะดั
- `/start` โ ะฟัะธะฒะตัััะฒะธะต ะธ ัะฟะธัะพะบ ะบะพะผะฐะฝะด
- `/add_client` โ ะผะฐััะตั ะดะพะฑะฐะฒะปะตะฝะธั ะบะปะธะตะฝัะฐ
- `/add_account` โ ะผะฐััะตั ะดะพะฑะฐะฒะปะตะฝะธั ะฐะบะบะฐัะฝัะฐ
- `/get_template` โ ะฟะพะปััะตะฝะธะต ัะฐะฑะปะพะฝะฐ Excel ะดะปั ัะพะฒะฐัะพะฒ
- `/collect_now` โ ะทะฐะฟััะบ ัะฑะพัะฐ ัะตะฝ ะฟััะผะพ ัะตะนัะฐั

### ะฃะฟัะฐะฒะปะตะฝะธะต ัะพะฒะฐัะฐะผะธ
- ะัะฟัะฐะฒััะต Excel ัะฐะนะป ั ัะพะฒะฐัะฐะผะธ ะดะปั ะธะผะฟะพััะฐ
- ะคะพัะผะฐั: `client_id | market | account_id | product_code | product_name | product_link`

### ะััะตัั
- `/snapshot YYYY-MM-DD` โ ะณะตะฝะตัะฐัะธั ะพััะตัะฐ ะทะฐ ะดะฐัั
- ะะถะตะดะฝะตะฒะฝัะต ัะฒะพะดะบะธ ะพัะฟัะฐะฒะปััััั ะฐะฒัะพะผะฐัะธัะตัะบะธ **ะฟะพัะปะต ะฟะพัะฒะปะตะฝะธั ะฝะพะฒัั ะดะฐะฝะฝัั**

## โฐ ะะฐัะฟะธัะฐะฝะธะต ะทะฐะดะฐั

- **ะะฐะถะดัะต 3 ะผะธะฝััั** โ ะัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ ะพััะตัะพะฒ ะพั ะฟะฐััะตัะฐ (Celery Beat)
- **ะัะฟัะฐะฒะบะฐ ะพััะตัะพะฒ** โ ะกัะฐะทั ะฟะพัะปะต ะทะฐะฟะธัะธ showcase_price ะฒ ะะ (ะฟะพ ัะฐะบัั ะฟะพัะฒะปะตะฝะธั ะฝะพะฒัั ะดะฐะฝะฝัั)

## ๐ ะกัััะบัััะฐ ะฑะฐะทั ะดะฐะฝะฝัั

### ะัะฝะพะฒะฝัะต ัะฐะฑะปะธัั
- `clients` โ ะบะปะธะตะฝัั ัะธััะตะผั
- `accounts` โ ะฐะบะบะฐัะฝัั ะผะฐัะบะตัะฟะปะตะนัะพะฒ
- `products` โ ัะพะฒะฐัั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ
- `orders` โ ะทะฐะบะฐะทั ะฝะฐ ัะฑะพั ะดะฐะฝะฝัั (task_id, ััะฐััั, ัััะปะบะฐ ะฝะฐ ะพััะตั)
- `results` โ ัะตะทัะปััะฐัั ะฟะพ ัะพะฒะฐัะฐะผ (ัะตะฝั, ัะบะธะดะบะธ, showcase_price)

### ะะปััะตะฒัะต ะฟะพะปั
- `parser_api_key` โ ะบะปัั ะดะปั ัะฐะฑะพัั ั ะฟะฐััะตัะพะผ
- `discount_percent` โ ะฟัะพัะตะฝั ัะบะธะดะบะธ ะกะะ
- `group_chat_id` โ ID ัะฐัะฐ ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน

## ๐ง ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ
```
pricebot/
โโโ bot/                 # Telegram ะฑะพั
โ   โโโ main.py         # ะัะฝะพะฒะฝะพะน ัะฐะนะป ะฑะพัะฐ
โโโ db/                 # ะะฐะทะฐ ะดะฐะฝะฝัั
โ   โโโ models.py       # SQLAlchemy ะผะพะดะตะปะธ
โ   โโโ session.py      # ะะฐัััะพะนะบะธ ัะตััะธะน
โโโ services/           # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โโโ parser_service_v2.py # ะะฐะฑะพัะฐ ั ะฟะฐััะตัะพะผ
โ   โโโ excel_loader.py      # ะะผะฟะพัั ัะพะฒะฐัะพะฒ
โ   โโโ reporters/          # ะะตะฝะตัะฐัะธั ะพััะตัะพะฒ
โโโ tasks/              # Celery ะทะฐะดะฐัะธ
โ   โโโ app_v2.py       # ะัะต ะทะฐะดะฐัะธ (ะฐะบััะฐะปัะฝะฐั ะฒะตััะธั)
โโโ docker-compose.yml  # Docker ะบะพะฝัะธะณััะฐัะธั
```

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
pip install -r requirements.txt

# ะะฐะฟััะบ ะฑะฐะทั ะดะฐะฝะฝัั
docker-compose up db redis -d

# ะะฐะฟััะบ ะฑะพัะฐ
python -m bot.main

# ะะฐะฟััะบ Celery worker
celery -A tasks.app_v2 worker --loglevel=info

# ะะฐะฟััะบ Celery beat
celery -A tasks.app_v2 beat --loglevel=info
```

## ๐ ะะธะณัะฐัะธะธ

```bash
# ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะน
docker-compose exec db psql -U pricebot -d pricebot -f /app/migration_add_orders_results.sql
```

## ๐ ะัะปะฐะดะบะฐ

### ะะพะณะธ
```bash
# ะะพะณะธ ะฑะพัะฐ
docker-compose logs -f bot

# ะะพะณะธ Celery
docker-compose logs -f worker

# ะะพะณะธ ะฑะฐะทั ะดะฐะฝะฝัั
docker-compose logs -f db
```

### ะขะตััะธัะพะฒะฐะฝะธะต
```bash
# ะะฐะฟััะบ ัะตััะพะฒ
python test_basic.py
```

## ๐งน ะัะธััะบะฐ ัะปัะถะตะฑะฝัั ัะฐะนะปะพะฒ

ะะปั ะพัะฒะพะฑะพะถะดะตะฝะธั ะผะตััะฐ ะผะพะถะฝะพ ะฑะตะทะพะฟะฐัะฝะพ ัะดะฐะปะธัั ะฒัะต ะฟะฐะฟะบะธ `__pycache__`:
```bash
find . -name "__pycache__" -type d -exec rm -r {} +
```

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ:

1. ะัะพะฒะตัััะต ะปะพะณะธ ะบะพะฝัะตะนะฝะตัะพะฒ
2. ะฃะฑะตะดะธัะตัั ะฒ ะฟัะฐะฒะธะปัะฝะพััะธ ะฝะฐัััะพะตะบ API ะบะปััะตะน
3. ะัะพะฒะตัััะต ะฟะพะดะบะปััะตะฝะธะต ะบ ะฑะฐะทะต ะดะฐะฝะฝัั
4. ะะฑัะฐัะธัะตัั ะบ ะดะพะบัะผะตะฝัะฐัะธะธ ะฟะฐััะตัะฐ API

## ๐ ะะฑะฝะพะฒะปะตะฝะธั

ะะปั ะพะฑะฝะพะฒะปะตะฝะธั ัะธััะตะผั:

```bash
# ะััะฐะฝะพะฒะบะฐ ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose down

# ะะฑะฝะพะฒะปะตะฝะธะต ะบะพะดะฐ
git pull

# ะะตัะตัะฑะพัะบะฐ ะธ ะทะฐะฟััะบ
docker-compose up -d --build
```

## ๐ ะะธัะตะฝะทะธั

ะัะพะตะบั ัะฐะทัะฐะฑะพัะฐะฝ ะดะปั ะฒะฝัััะตะฝะฝะตะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั. 